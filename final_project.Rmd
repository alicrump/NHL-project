---
title: "Final project"
author: "Ali Crump"
date: "10/4/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
library(tidyverse)
library(janitor)
library(ggplot2)
```

### Milestone4

My plan for my project was to webscrape it, but even after watching webscraper.io tutorials numerous times I couldn't successfully export the data. I downloaded the webscraper.io extension for Google Chrome and I first made the sitemap url this page [www.nhl.com](http://www.nhl.com/stats/player?reportType=season&seasonFrom=19171918&seasonTo=20192020&gameType=2&filter=gamesPlayed,gte,1&sort=points,goals,assists). I then made an element selector and highlighted the whole table. Within that element selector I made all of the text selectors: name, team, goals, etc. I wanted to make sure I got the single page to load before transitioning to the click element selector because there are nearly 50 pages of data. I also explored other selector types such as table, but was unable to get that to work. I might try another webscraper software and see if that might work.  
If I had gotten the webscraper to work, I would load the data in as a csv file and clean it using clean_names() and the janitor package. I would then explore it a bit using View(), glimpse(), and summary(). I was hoping to create a visual that showed the Philadelphia Flyers season vs points, so I would have filtered for the flyers then used ggplot and geom line or geom scatter perhaps. I'm curious to see how the team has improved or not improved throughout the years.    

I discussed the issues I've had and my current plan with Preceptor and he says that submitting what I have is fine. 


### Milestone 5

I successfully loaded the NHL team data and loaded half of the NHL player data. I think webscraper quits while extracting the player data because there are nearly 40,000 data entries and 800 total pages that webscraper must scan. I made my plot, which I described in Milestone 4, using the team data.  

```{r, read team data}
# Load team data

teams <- read_csv("raw-data/nhl_teams.csv", col_types = cols(
  team = col_character(),
  season = col_character(),
  games_played = col_double(),
  wins = col_double(),
  losses = col_double(),
  ties = col_double(),
  overtime = col_double(),
  points = col_double(),
  row = col_double(),
  p_perc = col_double(),
  goals_for = col_double(),
  goals_against = col_double(),
  goalsf_per_gp = col_double(),
  goalsa_per_gp = col_double(),
  powerplay_perc = col_double(),
  penalty_kill_perc = col_double(),
  shots_per_gp = col_double(),
  shots_against_per_gp = col_double(),
  fow_perc = col_double())) %>% 
  clean_names() %>% 
  na_if("--") %>% 
  select(-web_scraper_order, -web_scraper_start_url) %>% 
  separate(season, c("start","end"), sep = "-") %>% 
  mutate(start = as.numeric(start), end = as.numeric(end)) %>% 
  mutate(end = ifelse(start<=2000, end + 1900, end + 2000)) %>% 
  mutate(end = ifelse(start == 1999, 2000, end))
```


```{r, read player data}
# Load data from 1917-1918 to 1942-1943 seasons

one <- read_csv("raw-data/seventeen_to_fortytwo (1).csv") %>% 
  clean_names() %>% 
  na_if("--") %>% 
  select(-web_scraper_order, -web_scraper_start_url)

# Load data from 1943-1944 to 1968-1969 seasons

two <- read_csv("raw-data/fortythree_sixtyeight.csv") %>% 
  clean_names() %>% 
  na_if("--") %>% 
  select(-web_scraper_order, -web_scraper_start_url)

# Load data from 1969-1970 to 1982-1983 seasons

three <- read_csv("raw-data/sixtynine_eightytwo.csv") %>% 
  clean_names() %>% 
  na_if("--") %>% 
  select(-web_scraper_order, -web_scraper_start_url)

# Load data from 1983-1984 to 1990-1991 seasons

four <- read_csv("raw-data/eightythree_ninety.csv") %>% 
  clean_names() %>% 
  na_if("--") %>% 
  select(-web_scraper_order, -web_scraper_start_url)

# Load data from 1991-1992 to 1997-1998 seasons

five <- read_csv("raw-data/ninetyone_ninetyseven.csv") %>% 
  clean_names() %>% 
  na_if("--") %>% 
  select(-web_scraper_order, -web_scraper_start_url)

# Load data from 1998-1999 to 2005-2006 seasons

six <- read_csv("raw-data/ninetyeight_ohfive.csv") %>% 
  clean_names() %>% 
  na_if("--") %>% 
  select(-web_scraper_order, -web_scraper_start_url)

# Load data from 2006-2007 to 2012-2013 seasons

seven <- read_csv("raw-data/ohsix_twelve.csv") %>% 
  clean_names() %>% 
  na_if("--") %>% 
  select(-web_scraper_order, -web_scraper_start_url)

# Load data from 2013-2014 to 2019 seasons

eight <- read_csv("raw-data/thirteen_nineteen.csv") %>% 
  clean_names() %>% 
  na_if("--") %>% 
  select(-web_scraper_order, -web_scraper_start_url)
```


```{r, read player data}
# Join all the data frames into one

players <- rbind(eight,seven,six,five,four,three,two,one) %>% 
  distinct(name, season, team, goals, .keep_all = TRUE) %>% 
  separate(season, c("start","end"), sep = "-") %>% 
  mutate(start = as.numeric(start), end = as.numeric(end)) %>% 
  mutate(end = ifelse(start<=2000, end + 1900, end + 2000)) %>% 
  mutate(end = ifelse(start == 1999, 2000, end)) %>% 
  
  # Make all my data types doubles (or their appropriate type)
  
  mutate(points_per_gp = as.double(points_per_gp),
         shot_perc = as.double(shot_perc),
         shifts_gp = as.double(shifts_gp),
         fow_perc = as.double(fow_perc)
         )
```


```{r, move data}
# I'm moving my player and team data to the shiny app folder so that shiny can "see" it.

write_rds(teams, "nhl/teams.rds")
write_rds(players, "nhl/players.rds")


```



### Milestone 4
```{r}
# I created this graphic before I needed to change my season variable so the
# x axis is not quite right
# Create a graphic using Philadelphia Flyers team data. Remove the current
# season statistics and plot the Flyers' team points over the past 50 years.

teams %>% 
  filter(team == "Philadelphia Flyers", points != is.na(points), start != 2019) %>%
  ggplot(aes(x = start, y = points)) +
  geom_col(fill = "chocolate1") +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  labs(title = "Philadelphia Flyers Points", subtitle = "1967-2018 Seasons") +
  xlab("Season") +
  ylab("Points") +
  theme(legend.position = "none", legend.title = element_blank())
```

```{r}
# I created this graphic before I needed to change my season variable so the
# x axis is not quite right

teams %>% 
  filter(team == "Philadelphia Flyers", points != is.na(points), start != 2019) %>%
  ggplot(aes(x = start, y = goals_for)) +
  geom_col(fill = "chocolate1") +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  labs(title = "Philadelphia Flyers Goals", subtitle = "1967-2018 Seasons") +
  xlab("Season") +
  ylab("Goals") +
  theme(legend.position = "none", legend.title = element_blank())
```

```{r}
flyers <- teams %>% 
  filter(team == "Philadelphia Flyers")
```

